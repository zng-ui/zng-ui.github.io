<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content=" Declares new app local variable."><title>app_local in zng_app_context - Rust</title><script> if (window.location.protocol !== "file:") document.write(`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2">`)</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-e935ef01ae1c1829.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="zng_app_context" data-themes="" data-resource-suffix="" data-rustdoc-version="1.78.0 (9b00956e5 2024-04-29)" data-channel="1.78.0" data-search-js="search-42d8da7a6b9792c2.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-4c98445ec4002617.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-12cf3b4f4f9dc36d.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-04d5337699b92874.css"></noscript><link rel="icon" href="https://raw.githubusercontent.com/zng-ui/zng/main/examples/image/res/zng-logo-icon.png"></head><body class="rustdoc macro"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../zng_app_context/index.html"><img src="https://raw.githubusercontent.com/zng-ui/zng/main/examples/image/res/zng-logo.png" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../zng_app_context/index.html"><img src="https://raw.githubusercontent.com/zng-ui/zng/main/examples/image/res/zng-logo.png" alt="logo"></a><h2><a href="../zng_app_context/index.html">zng_app_context</a><span class="version">0.5.0</span></h2></div><div class="sidebar-elems"></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../zng_app_context/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Macro <a href="index.html">zng_app_context</a>::<wbr><a class="macro" href="#">app_local</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/zng_app_context/lib.rs.html#867-877">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><span class="macro">macro_rules!</span> app_local {
    ($(
        $(<span class="attr">#[<span class="macro-nonterminal">$meta</span>:meta]</span>)*
        <span class="macro-nonterminal">$vis</span>:vis <span class="kw">static </span><span class="macro-nonterminal">$IDENT</span>:ident : <span class="macro-nonterminal">$T</span>:ty = $(<span class="kw">const </span>{ <span class="macro-nonterminal">$init_const</span>:expr })<span class="question-mark">? </span>$(<span class="macro-nonterminal">$init</span>:expr)<span class="question-mark">?</span>;
    )+) =&gt; { ... };
}</pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p><span data-del-macro-root></span> Declares new app local variable.</p>
<p>An app local is a static variable that is declared using the same syntax as <a href="https://doc.rust-lang.org/1.78.0/std/macro.thread_local.html" title="macro std::thread_local"><code>thread_local!</code></a>, but can be
accessed by any thread in the app. In apps that only run once per process it compiles down to the equivalent
of a <code>static LOCAL: RwLock&lt;T&gt; = const;</code> or <code>static LOCAL: RwLock&lt;Option&lt;T&gt;&gt;</code> that initializes on first usage. In test
builds with multiple parallel apps it compiles to a switching storage that provides a different value depending on
what app is running in the current thread.</p>
<p>See <a href="struct.AppLocal.html" title="struct zng_app_context::AppLocal"><code>AppLocal&lt;T&gt;</code></a> for more details.</p>
<h2 id="multi-app"><a class="doc-anchor" href="#multi-app">§</a>Multi App</h2>
<p>If the crate is compiled with the <code>&quot;multi_app&quot;</code> feature a different internal implementation is used that supports multiple
apps, either running in parallel in different threads or one after the other. This backing implementation has some small overhead,
but usually you only want multiple app instances per-process when running tests.</p>
<p>The lifetime of <code>&quot;multi_app&quot;</code> locals is also more limited, trying to use an app-local before starting to build an app will panic,
the app-local value will be dropped when the app is dropped. Without the <code>&quot;multi_app&quot;</code> feature the app-locals can be used at
any point before or after the app lifetime, values are not explicitly dropped, just unloaded with the process.</p>
<h2 id="const"><a class="doc-anchor" href="#const">§</a>Const</h2>
<p>The initialization expression can be wrapped in a <code>const { .. }</code> block, if the <code>&quot;multi_app&quot;</code> feature is <strong>not</strong> enabled
a faster implementation is used that is equivalent to a direct <code>static LOCAL: RwLock&lt;T&gt;</code> in terms of performance.</p>
<p>Note that this syntax is available even if the <code>&quot;multi_app&quot;</code> feature is enabled, the expression must be const either way,
but with the feature the same dynamic implementation is used.</p>
<p>Note that <code>const</code> initialization does not automatically convert the value into the static type.</p>
<h2 id="examples"><a class="doc-anchor" href="#examples">§</a>Examples</h2>
<p>The example below declares two app locals, note that <code>BAR</code> init value automatically converts into the app local type.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="macro">app_local!</span> {
    <span class="doccomment">/// A public documented value.
    </span><span class="kw">pub static </span>FOO: u8 = <span class="kw">const </span>{ <span class="number">10u8 </span>};

    <span class="comment">// A private value.
    </span><span class="kw">static </span>BAR: String = <span class="string">"Into!"</span>;
}

<span class="kw">let </span>app = LocalContext::start_app(AppId::new_unique());

<span class="macro">assert_eq!</span>(<span class="number">10</span>, FOO.get());</code></pre></div>
<p>Also note that an app context is started before the first use, in <code>multi_app</code> builds trying to use an app local in
a thread not owned by an app panics.</p>
</div></details></section></div></main></body></html>